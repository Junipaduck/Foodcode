<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.foodcode.mapper.AdminMapper">
	
	<select id="selectMemberList" resultType="com.itwillbs.foodcode.vo.MemberVO">
		SELECT *
			FROM member
				WHERE member_type = 'c';
	</select>
	
	<select id="selectOwnerList" resultType="com.itwillbs.foodcode.vo.MemberVO">
		SELECT *
			FROM member
				WHERE member_type = 'o';
	</select>
	
	<delete id="deleteMember">
		DELETE FROM member
			WHERE member_idx = #{member_idx} AND member_id = #{member_id};
	</delete>
	
	<select id="selectStoreList" resultType="com.itwillbs.foodcode.vo.StoreVO">
		SELECT *
			FROM store;
	</select>
	
	<select id="selectReviews" resultType="com.itwillbs.foodcode.vo.ReviewVO">
		SELECT *
			FROM review
	</select>
	
	<select id="getStoreList2" resultType="map">
	SELECT m.member_id, m.member_email, s.store_name, s.store_license, s.auth_status, ROUND(AVG(re.review_star),1) AS review_star
		FROM member m
			JOIN store s ON m.member_id = s.member_id
				LEFT JOIN review re ON s.store_idx = re.store_idx
					GROUP BY s.store_name;
	</select>
	
	<delete id="deleteStore">
	DELETE
	 FROM store
	 	WHERE store_license = #{store_license} AND member_id = #{owner_id}
	</delete>
	
	
	<select id="getMemberCount" resultType="String">
		SELECT COUNT(*) FROM member
			WHERE member_type = 'C';
	</select>
	
	<select id="getOwnerCount" resultType="String">
		SELECT COUNT(*) FROM member
			WHERE member_type = 'O';
	</select>
	
	<select id="getStoreCount" resultType="String">
		SELECT COUNT(*) FROM store;
	</select>
	
	<select id="getNoticeCount" resultType="String">
		SELECT COUNT(*) FROM notice;
	</select>
	
	<select id="getReportCount" resultType="String">
		SELECT COUNT(*) FROM report;
	</select>
	
	<select id="getNoApprove" resultType="map">
		SELECT m.member_id, s.store_name, s.store_license, s.store_type , s.store_date, s.auth_status
		FROM member m
			JOIN store s ON m.member_id = s.member_id
				WHERE s.auth_status = 'N'
				ORDER BY s.store_date ASC;
	</select>
	
	<update id="updateStoreApprove">
		UPDATE store 
 			SET auth_status = 'Y'
 				WHERE store_license = "${store_license}";
	</update>
	
	
	
</mapper>






















































